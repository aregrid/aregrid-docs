var b=Object.defineProperty,w=Object.defineProperties;var A=Object.getOwnPropertyDescriptors;var I=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var E=(o,t,e)=>t in o?b(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,f=(o,t)=>{for(var e in t||(t={}))v.call(t,e)&&E(o,e,t[e]);if(I)for(var e of I(t))M.call(t,e)&&E(o,e,t[e]);return o},S=(o,t)=>w(o,A(t));import{l as p,o as _,c as m,a as c,n as g,F as N,r as B,b as U}from"./vendor.c9313334.js";const L=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function e(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=e(r);fetch(r.href,n)}};L();const d={INSERT_CHARTER:"INSERT_CHARTER",DELETE_CHARTER:"DELETE_CHARTER"},x=/Mac/i.test(navigator.platform)?"metaKey":"ctrlKey";class u{static match(t,e){return["altKey","ctrlKey","metaKey","shiftKey"].some(s=>!!e[s]!==t[s]&&e[s]!==null)?!1:e.key===t.key||e.key===t.which}constructor(t){this.editor=t,this.bindings={},Object.keys(u.DEFAULTS.bindings).forEach(e=>{u.DEFAULTS.bindings[e]&&this.addBinding(u.DEFAULTS.bindings[e])}),this.listen()}addBinding(t,e={},s={}){const r=O(t);if(r==null){console.warn("Attempted to add invalid keyboard binding",r);return}typeof e=="function"&&(e={handler:e}),typeof s=="function"&&(s={handler:s}),(Array.isArray(r.key)?r.key:[r.key]).forEach(i=>{const l=f(f(S(f({},r),{key:i}),e),s);this.bindings[l.key]=this.bindings[l.key]||[],this.bindings[l.key].push(l)})}getBindsByEvt(t){if(t.key.length===1&&(!this.bindings[t.key]||this.bindings[t.key].length===0)){let e=p.cloneDeep(u.DEFAULTS.bindings.insertCharacter);return e.key=t.key,this.addBinding(t.key,e),this.bindings[t.key]||[]}return this.bindings[t.key]||[]}listen(){this.editor.getRoot().focus(),this.editor.getRoot().addEventListener("keydown",t=>{if(t.defaultPrevented||t.isComposing)return;let s=this.getBindsByEvt(t).concat(this.bindings[t.which]||[]).filter(l=>u.match(t,l));if(s.length===0)return;const r=this.editor.getSelection(),n={userInput:t.key};s.some(l=>l.handler.call(this,r,n,l)!==!0)&&t.preventDefault()})}}u.DEFAULTS={bindings:{Undo:{key:"z",shortKey:!0,handler(){this.editor.undo()}},Backspace:{key:"Backspace",handler(o,t){let e={type:d.DELETE_CHARTER,startIndex:o[0]};return this.editor.flush(e),!1}},Enter:{key:"Enter",metaKey:null,ctrlKey:null,altKey:null,handler(o,t){let e={type:d.INSERT_CHARTER,startIndex:o[0],value:`
`};return this.editor.flush(e),!1}},insertCharacter:{handler(o,t){let e={type:d.INSERT_CHARTER,startIndex:o[0],value:t.userInput};return this.editor.flush(e),!1}},left:{key:"ArrowLeft",handler(){this.editor.getCursorInfo().locationX>0?this.editor.updateCursorInfo(--this.editor.getCursorInfo().locationX):this.editor.getCursorInfo().locationY>0&&this.editor.updateCursorInfo(void 0,--this.editor.getCursorInfo().locationY),this.editor.flush()}},right:{key:"ArrowRight",handler(){this.editor.getCursorInfo().locationX+1<=this.editor.getCurrentBlockCharacterCount()&&(this.editor.updateCursorInfo(++this.editor.getCursorInfo().locationX),this.editor.flush())}},up:{key:"ArrowUp",handler(){this.editor.getCursorInfo().locationY>0&&this.editor.updateCursorInfo(void 0,--this.editor.getCursorInfo().locationY),this.editor.flush()}},down:{key:"ArrowDown",handler(){this.editor.getCursorInfo().locationY<this.editor.blocks.length-1&&(this.editor.updateCursorInfo(void 0,++this.editor.getCursorInfo().locationY),this.editor.flush())}}}};function O(o){if(typeof o=="string"||typeof o=="number")o={key:o};else if(typeof o=="object")o=p.cloneDeep(o);else return null;return o.shortKey&&(o[x]=o.shortKey,delete o.shortKey),o}var k={insertStr(o,t,e){return o.slice(0,t)+e+o.slice(t)},removeStr(o,t){return o.slice(0,t)+o.slice(t+1)}};class F{constructor(){this.spacers_=""}getSpackers(){return this.spacers_}insertStr(t,e){return k.insertStr(this.spacers_,t,e)}removeStr(t){return k.removeStr(this.spacers_,t)}getSpackerAt(t){return this.spacers_.substr(t,1)}updateSpacers(t){this.spacers_=t}}function C(){}C.prototype={undoCommands:[],undo(){return this.undoCommands.pop()},record(o){this.undoCommands.push(o)}};var a;function H(o,t){o.sandbox="allow-same-origin",o.contentWindow.document.open(),o.contentWindow.document.write(t),o.contentWindow.document.close()}var T={getHtmlSize(o){if(!o)return{width:0};if(o=o.replace(/\s/g,"&nbsp;"),!a){a=document.createElement("iframe"),a.style.visibility="hidden";var t='<body><span id="box"></span></body>';document.body.appendChild(a),H(a,t)}let e=a.contentWindow.document.getElementById("box");return e.setAttribute("style","font-size:14px;"),e.innerHTML=o,a.contentWindow.document.getElementById("box").getBoundingClientRect()}},h={PADDING_TOP:15,PADDING_LEFT:15};const y={UNDO:"UNDO",USER_EDIT:"USER_EDIT"};class D{constructor(){this.history_=new C,this.model_=new F,this.commands_=[],this.cursorInfo_={locationX:0,locationY:0},this.cursorStyle_={},this.blocks_=[]}applyCommand(t,{editSource:e=y.UNDO}){this.commands_.push(t),this.updateModel(t,{editSource:e})}getCursorSpacerIndex(){let t=0;if(this.cursorInfo_.locationY>0){let s=this.blocks_.slice(0,this.cursorInfo_.locationY),r=0;s.forEach(n=>r+=n.html.length),t=r+this.cursorInfo_.locationY}return t+this.cursorInfo_.locationX}updateBlocks(){let t=this.model_.getSpackers().split(`
`);this.blocks_=t.map(e=>({html:e})),this.blocksForRedraw_=this.blocks_.map(e=>{let s=e.html.replace(/\s/g,"&nbsp;"),r=T.getHtmlSize(s);return{html:s,overlayStyle:{width:r.width+"px",height:r.height+"px"}}})}getBlocksForRedraw(){return this.blocksForRedraw_}getSelection(){return[this.getCursorSpacerIndex(),this.getCursorSpacerIndex()]}getCurrentCursorLoctionX(){return this.getCurrentBlock().html.length}updateModel(t,{editSource:e=y.USER_EDIT}={}){if(t.type===d.INSERT_CHARTER){let s=t.startIndex;e===y.USER_EDIT&&this.history_.record({type:d.DELETE_CHARTER,startIndex:s+1});let r=this.model_.insertStr(s,t.value);this.model_.updateSpacers(r),t.value===`
`?(this.cursorInfo_.locationY+=1,this.cursorInfo_.locationX=0):this.cursorInfo_.locationX+=1}else if(t.type===d.DELETE_CHARTER){let s=t.startIndex;if(s===0)return;let r=this.model_.getSpackerAt(s-1);e===y.USER_EDIT&&this.history_.record({type:d.INSERT_CHARTER,startIndex:s,value:r}),this.removeSpackerIndex(s-1)}}removeSpackerIndex(t){if(this.model_.getSpackerAt(t)===`
`){let r;this.cursorInfo_.locationY>0&&(r=this.blocks_[this.cursorInfo_.locationY-1].html.length),this.cursorInfo_.locationY-=1,this.cursorInfo_.locationX=r}else this.cursorInfo_.locationX-=1;let s=this.model_.removeStr(t);this.model_.updateSpacers(s)}getCurrentBlock(){return this.blocks_[this.cursorInfo_.locationY]||{html:""}}updateCursor(){this.blocks_.length;let t=this.getCurrentBlock();this.cursorStyle_={left:h.PADDING_LEFT+T.getHtmlSize(t.html.substr(0,this.cursorInfo_.locationX)).width+"px",top:h.PADDING_TOP+20*this.cursorInfo_.locationY+"px"}}getCursorStyle(){return this.cursorStyle_}getCursorInfo(){return this.cursorInfo_}updateCursorInfo(t,e){p.isUndefined(t)||(this.cursorInfo_.locationX=t),p.isUndefined(e)||(this.cursorInfo_.locationY=e)}undo(){return this.history_.undo()}getCommands(){return this.commands_}}var Y=(o,t)=>{const e=o.__vccOpts||o;for(const[s,r]of t)e[s]=r;return e};const R={UNDO:"UNDO",USER_EDIT:"USER_EDIT"},P={name:"App",data(){return{toolbarMenus:[{key:"bold"},{key:"italic"},{key:"underline"},{key:"strikethrough"}],cursorStyle:{},blocks:[],editStyle:{paddingTop:h.PADDING_TOP+"px",paddingBottom:h.PADDING_TOP+"px",paddingLeft:h.PADDING_LEFT+"px",paddingRight:h.PADDING_LEFT+"px"}}},components:{},methods:{undo(){this.flush(this.modeState_.undo(),{editSource:R.UNDO})},flush(o,{editSource:t=R.USER_EDIT}={}){o&&this.modeState_.applyCommand(o,{editSource:t}),this.redraw()},redraw(){this.modeState_.updateBlocks(),this.modeState_.updateCursor(),this.blocks=this.modeState_.getBlocksForRedraw(),this.cursorStyle=this.modeState_.getCursorStyle()},onEditorMouseDown(){this.startMouse=!0,this.curorMoveInfo=[0,0,0,0]},onEditorMouseUp(){this.startMouse=!1},onEditorMouseMove(o){this.startMouse&&console.log(o)},getRoot(){return window},getSelection(){return this.modeState_.getSelection()},getCursorInfo(){return this.modeState_.getCursorInfo()},updateCursorInfo(){this.modeState_.updateCursorInfo.apply(this.modeState_,arguments)},getCurrentBlockCharacterCount(){return this.modeState_.getCurrentBlock().html.length},replay(){let o=e=>{if(e.length===0)return;let s=e[0];setTimeout(()=>{this.flush(s),e.splice(0,1),o(e)},200)},t=JSON.parse(JSON.stringify(this.modeState_.getCommands()));this.blocks=[],this.modeState_=new D,o(t)}},mounted(){this.keyboard_=new u(this),this.modeState_=new D}},z={class:"zd"},X={class:"zd-toolbar"},G={class:"zd-block"},K=["innerHTML"];function W(o,t,e,s,r,n){return _(),m("div",z,[c("div",X,[c("button",{onClick:t[0]||(t[0]=(...i)=>n.replay&&n.replay(...i))},"replay command record")]),c("div",{class:"zd-editor",ref:"editor",style:g(r.editStyle),onMousedown:t[1]||(t[1]=(...i)=>n.onEditorMouseDown&&n.onEditorMouseDown(...i)),onMouseup:t[2]||(t[2]=(...i)=>n.onEditorMouseUp&&n.onEditorMouseUp(...i)),onMousemove:t[3]||(t[3]=(...i)=>n.onEditorMouseMove&&n.onEditorMouseMove(...i))},[c("span",{style:g(r.cursorStyle),class:"zd-cursor"},null,4),(_(!0),m(N,null,B(r.blocks,i=>(_(),m("p",G,[c("div",{innerHTML:i.html},null,8,K),c("div",{class:"overlay",style:g(i.overlayStyle)},null,4)]))),256))],36)])}var V=Y(P,[["render",W]]);U(V).mount("#app");
